# quiz

`quiz` - REST API для проведения викторин.

## Подробная документация по API
После запуска сервиса документация по API с примерами запросов и ответов будет доступна по ссылкам:
- `<host_address>:8000/docs`
- `<host_address>:8000/redoc`


## Краткое описание API:
API принимает запросы на 3 эндпойнта:

`/api/v1/quiz` (POST) - Отправка кол-ва вопросов для старта викторины. В ответ высылается первый вопрос и id викторины
`/api/v1/answer` (POST) - Отправка ответа на вопрос викторины. В ответ высылается правильный ответ и следующий вопрос.
`/api/v1/quiz/next_question/{quiz_id}` (GET)- Получение следующего вопроса викторины (на случай, если id вопроса, полученный на эндпойнт `/api/v1/answer` был утерян).

### /api/v1/quiz - пример запроса и ответа:
#### Тело запроса:
```
{"questions_num": 5}
```
#### Тело ответа:
```
{
    "question": "Текст следующего вопроса",
    "question_id": 2345,
    "quiz_id": "a038f339-2c66-4565-90e8-8507da656fa0"
}
```
### /api/v1/answer - пример запроса и ответа:
#### Тело запроса:
```
{
    "answer": "Ответ",
    "question_id": 12458,
    "quiz_id": "a038f339-2c66-4565-90e8-8507da656fa0"
}
```
#### Тело ответа:
```
{
    "previous_question_correct_answer": "Правильный ответ на предыдущий вопрос",
    "question": "Текст следующего вопроса",
    "question_id": 2345,
    "quiz_id": "a038f339-2c66-4565-90e8-8507da656fa0"
}
```
В случае, если был отправлен запрос с ответом на последний вопрос викторины, ответ сервиса будет таким:
```
{
    "previous_question_correct_answer": "Правильный ответ на предыдущий вопрос",
    "quiz_id": "a038f339-2c66-4565-90e8-8507da656fa0"
}
```


## Системные требования
- Python 3.11+
- Works on Linux, Windows, macOS

## Основные технологии:
- Python 3.11
- FastAPI
- PostgreSQL
- SQLAlchemy
- Alembic 
- Uvicorn
- Pytest

## Как запустить проект:

Для запуска в проект вложена конфигурация docker-compose. После запуска docker-compose API будет доступно по адресу: `http://<host address>:8000/api/v1`

Необходимо выполнить следующие шаги:

Склонируйте репозиторий с GitHub и перейдите в папку проекта, где расположен файл docker-compose.yml:

```
git clone git@github.com:KostKH/quiz.git
cd quiz/infra_quiz/
```

Проверьте, что на машине / сервере установлены `docker` и `docker compose`

Cоздайте в папке `infra_quiz` файл `.env` с переменными окружения. Можно создать его из вложенного образца `env_example.env`:
```
cp env_example.env .env
```
Откройте файл .env в редакторе и поменяйте, при необходимости, переменные окружения. Обязательно поменяйте пароль к базе данных.

Установите и запустите приложение в контейнере. (Возможно, вам придется добавить `sudo` перед текстом команды):
```
docker compose up -d
```
Запустите миграции:
```
docker compose exec app alembic upgrade head
```
После этого приложение будет запущено, документация по API будет доступна по  адресам:
- `<host_address>:8000/docs`
- `<host_address>:8000/redoc`

Если вы хотите протестировать приложение, то после выполнения предыдущих команд, находясь в папке `infra_quiz`, запустите команду:
```
docker compose exec app pytest
```

## О программе:

Автор: Константин Харьков